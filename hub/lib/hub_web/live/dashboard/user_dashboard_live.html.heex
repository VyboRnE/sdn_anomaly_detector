<div class="space-y-6 bg-gray-100 min-h-screen p-6 text-gray-900">

  <!-- –ö–Ω–æ–ø–∫–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è —Å–µ–Ω—Å–æ—Ä–∞ -->
  <div>
    <button phx-click="add_sensor" class="bg-black text-white px-4 py-2 rounded-lg hover:bg-gray-800 transition">
      ‚ûï –î–æ–¥–∞—Ç–∏ —Å–µ–Ω—Å–æ—Ä
    </button>
  </div>

  <!-- –§–æ—Ä–º–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è -->
  <%= if @show_add_form do %>
    <div class="p-6 border border-gray-300 rounded-lg shadow-md bg-white">
      <h3 class="text-lg font-semibold mb-4">–ù–æ–≤–∏–π —Å–µ–Ω—Å–æ—Ä</h3>
      <form phx-submit="save_sensor">
        <input type="text" name="sensor[name]" placeholder="–ù–∞–∑–≤–∞ —Å–µ–Ω—Å–æ—Ä–∞"
          class="border border-gray-300 px-3 py-2 rounded w-full mb-4 focus:outline-none focus:ring-2 focus:ring-black" />
        <button type="submit" class="bg-gray-900 text-white px-4 py-2 rounded hover:bg-gray-700 transition">üíæ
          –ó–±–µ—Ä–µ–≥—Ç–∏</button>
      </form>
    </div>
    <% end %>

      <!-- –¢–∞–±–ª–∏—Ü—è —Å–µ–Ω—Å–æ—Ä—ñ–≤ -->
      <div class="overflow-x-auto">
        <table class="table-auto w-full border-collapse border border-gray-300 shadow-sm bg-white rounded-lg">
          <thead>
            <tr class="bg-gray-200 text-gray-800">
              <th class="border border-gray-300 px-4 py-2 text-left">–ù–∞–∑–≤–∞</th>
              <th class="border border-gray-300 px-4 py-2 text-left">API –ö–ª—é—á</th>
            </tr>
          </thead>
          <tbody>
            <%= for sensor <- @sensors do %>
              <tr phx-click="select_sensor" phx-value-sensor_id={sensor.id} class={"cursor-pointer transition
                hover:bg-gray-100 " <> if @selected_sensor && sensor.id == @selected_sensor.id, do: " bg-gray-300",
                else: "" }>
                <td class="border border-gray-300 px-4 py-2">
                  <%= sensor.name %>
                </td>
                <td class="border border-gray-300 px-4 py-2">
                  <%= sensor.api_key || "‚Äì" %>
                </td>
              </tr>
              <% end %>
          </tbody>
        </table>
      </div>

      <!-- –î–µ—Ç–∞–ª—ñ —Å–µ–Ω—Å–æ—Ä–∞ -->
      <%= if @selected_sensor do %>
        <div class="p-6 border border-gray-300 rounded-lg shadow bg-white">
          <h2 class="text-xl font-semibold mb-4">–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ —Å–µ–Ω—Å–æ—Ä: <%= @selected_sensor.name %>
          </h2>
          <p class="mb-4"><strong>API –∫–ª—é—á:</strong>
            <%= @selected_sensor.api_key || "–Ω–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ" %>
          </p>

          <form phx-change="change_period" class="mb-4">
            <div class="flex  gap-4">
              <label class="block text-l font-medium text-black mb-4" for="period">
                –ü–µ—Ä—ñ–æ–¥ –ø–µ—Ä–µ–≥–ª—è–¥—É:
              </label>
              <select name="period" id="period"
                class="bg-gray-900 text-white border border-gray-600 px-3 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-white transition">
                <option value="1" selected={@search_period=="1" }>–û—Å—Ç–∞–Ω–Ω—è –≥–æ–¥–∏–Ω–∞</option>
                <option value="3" selected={@search_period=="3" }>–û—Å—Ç–∞–Ω–Ω—ñ 3 –≥–æ–¥–∏–Ω–∏</option>
                <option value="6" selected={@search_period=="6" }>–û—Å—Ç–∞–Ω–Ω—ñ 6 –≥–æ–¥–∏–Ω</option>
                <option value="12" selected={@search_period=="12" }>–û—Å—Ç–∞–Ω–Ω—ñ 12 –≥–æ–¥–∏–Ω–∏</option>
                <option value="24" selected={@search_period=="24" }>–û—Å—Ç–∞–Ω–Ω—ñ 24 –≥–æ–¥–∏–Ω–∏</option>
              </select>
            </div>
          </form>

          <%= if @stats !=[] do %>

            <section class="mt-6">
              <h3 class="text-lg font-medium mb-2">üìä –¢—Ä–∞—Ñ—ñ–∫ —ñ –∞–Ω–æ–º–∞–ª—ñ—ó —É —á–∞—Å—ñ</h3>
              <div id="trafficAnomalyChart" phx-hook="TrafficAnomalyChart" data-chart={Jason.encode!(%{ categories:
                Enum.map(@stats, &Timex.format!(&1.time, "{ISO:Extended}" )), total_packets: Enum.map(@stats, &
                &1.total_packet_count), anomaly_flags: Enum.map(@stats, &(&1.anomaly_count || 0)) })}
                class="w-full h-64 bg-gray-50 border border-gray-200 rounded-lg shadow-inner">
              </div>
            </section>

            <section class="mt-6">
              <h3 class="text-lg font-medium mb-2">üîç –†–æ–∑–ø–æ–¥—ñ–ª –ø—Ä–æ—Ç–æ–∫–æ–ª—ñ–≤ —É —á–∞—Å—ñ</h3>
              <div id="protocolDistributionChart" phx-hook="ProtocolDistributionChart" data-chart={Jason.encode!(%{
                categories: Enum.map(@stats, &Timex.format!(&1.time, "{ISO:Extended}" )), tcp: Enum.map(@stats,
                &(&1.proto_tcp_count || 0)), udp: Enum.map(@stats, &(&1.proto_udp_count || 0)), icmp: Enum.map(@stats,
                &(&1.proto_icmp_count || 0)) })}
                class="w-full h-64 bg-gray-50 border border-gray-200 rounded-lg shadow-inner">
              </div>
            </section>

            <section class="mt-6">
              <h3 class="text-lg font-medium mb-2">‚ö†Ô∏è –ú–µ—Ç–æ–¥ –≤–∏—è–≤–ª–µ–Ω–Ω—è –∞–Ω–æ–º–∞–ª—ñ—ó: CUSUM, Isolation Forest</h3>
              <div id="anomalyComparisonChart" phx-hook="AnomalyComparisonChart" data-chart={Jason.encode!(%{
                categories: Enum.map(@stats, &Timex.format!(&1.time, "{ISO:Extended}" )), cusum: Enum.map(@stats, &
                &1.cusum_anomaly_count), isolation: Enum.map(@stats, & &1.isolation_anomaly_count) })}
                class="w-full h-64 bg-gray-50 border border-gray-200 rounded-lg shadow-inner">
              </div>
            </section>

            <section class="mt-6">
              <h3 class="text-lg font-medium mb-2">üéØ –¢–æ–ø —Ü—ñ–ª—å–æ–≤–∏—Ö –ø–æ—Ä—Ç—ñ–≤</h3>
              <div id="topPortsChart" phx-hook="TopPortsChart" data-chart={Jason.encode!(%{ ports: Enum.map(@top_ports,
                & &1.port), counts: Enum.map(@top_ports, & &1.count) })}
                class="w-full h-64 bg-gray-50 border border-gray-200 rounded-lg shadow-inner">
              </div>
            </section>

            <section class="mt-6">
              <h3 class="text-lg font-medium mb-2">üåç –£–Ω—ñ–∫–∞–ª—å–Ω—ñ IP-–∞–¥—Ä–µ—Å–∏ —É —á–∞—Å—ñ</h3>
              <div id="uniqueIpsChart" phx-hook="UniqueIpsChart" data-chart={Jason.encode!(%{ categories:
                Enum.map(@stats, &Timex.format!(&1.time, "{ISO:Extended}" )), unique_src_ips: Enum.map(@stats, &
                &1.total_unique_src_ips) })}
                class="w-full h-64 bg-gray-50 border border-gray-200 rounded-lg shadow-inner">
              </div>
            </section>

            <% else %>
              <p class="text-gray-600">–ù–µ–º–∞—î —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –∑–∞ –¥–∞–Ω–∏–º —Å–µ–Ω—Å–æ—Ä–æ–º.</p>
              <% end %>
        </div>
        <% else %>
          <p class="text-gray-700">–û–±–µ—Ä—ñ—Ç—å —Å–µ–Ω—Å–æ—Ä –∑—ñ —Å–ø–∏—Å–∫—É –≤–∏—â–µ, —â–æ–± –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –¥–µ—Ç–∞–ª—ñ.</p>
          <% end %>

</div>